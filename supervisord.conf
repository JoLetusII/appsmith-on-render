[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[inet_http_server]
# Expose Supervisor UI internally; nginx proxies it at /supervisor/
port=127.0.0.1:9001

[supervisorctl]
serverurl=http://127.0.0.1:9001

# -------- Processes --------

# Nginx stays in foreground; start AFTER we render config in start.sh
[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autorestart=true
priority=10
stdout_logfile=/var/log/supervisor/nginx.stdout.log
stderr_logfile=/var/log/supervisor/nginx.stderr.log

# Appsmith Server (Java). The fat image ships the server JAR at this path.
# If your image layout differs, exec into a running container and `ls /opt/appsmith` to adjust.
[program:appsmith-server]
command=/bin/bash -lc 'exec java -XX:+UseZGC -Dserver.port=8080 -jar /opt/appsmith/backend/server.jar'
directory=/opt/appsmith
environment=JAVA_TOOL_OPTIONS="-XX:MaxRAMPercentage=75"
autorestart=true
priority=20
stdout_logfile=/var/log/supervisor/server.stdout.log
stderr_logfile=/var/log/supervisor/server.stderr.log
startretries=999

# Real-time service (Node). Path is correct for current fat images.
[program:appsmith-rts]
command=/bin/bash -lc 'exec node /opt/appsmith/rts/server/dist/server.js'
directory=/opt/appsmith
autorestart=true
priority=30
stdout_logfile=/var/log/supervisor/rts.stdout.log
stderr_logfile=/var/log/supervisor/rts.stderr.log
startretries=999


